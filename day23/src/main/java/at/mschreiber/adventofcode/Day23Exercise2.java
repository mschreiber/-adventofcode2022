package at.mschreiber.adventofcode;

import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

public class Day23Exercise2 {

	public static List<Elve> elves = new ArrayList<>();

	public static void main(String[] args) {
		String[] lines = input.split("\r\n");
		for (int y = 0; y < lines.length; y++) {
			for (int x = 0; x < lines[y].length(); x++) {
				if (lines[y].charAt(x) == '#') {
					elves.add(new Elve(x, y));
				}
			}
		}

		int direction = 1;

		int a = 0;
		boolean end = false;
		do {

			List<Elve> elvesToMove = elves.stream().filter(it -> hasElvesArround(it)).collect(Collectors.toList());
			for (Elve e : elvesToMove) {
				e.considerNextStep(direction, elves);
			}

			List<Elve> movingElves = elvesToMove.stream().filter(it -> !isOnSamePlace(it)).collect(Collectors.toList());
			List<Elve> notMovingElves = elvesToMove.stream().filter(it -> isOnSamePlace(it)).collect(Collectors.toList());

			movingElves.forEach(it -> it.doMove());
			notMovingElves.forEach(it -> it.doNotMove());

			a++;
			end = movingElves.size() == 0;

			direction++;
			if (direction == 5) {
				direction = 1;
			}
		} while (!end);

		System.out.println("No elve moved in round: " + a);
	}

	private static boolean isOnSamePlace(Elve it) {
		for (Elve elve : elves) {
			if (elve == it) {
				continue;
			}
			if (elve.proposedX == it.proposedX && elve.proposedY == it.proposedY) {
				return true;
			}
		}
		return false;
	}

	private static boolean hasElvesArround(Elve it) {
		for (Elve elve : elves) {
			if (elve == it) {
				continue;
			}
			if (elve.x == it.x + 1 && elve.y == it.y) // w
				return true;
			if (elve.x == it.x + 1 && elve.y == it.y - 1) // sw
				return true;
			if (elve.x == it.x - 1 && elve.y == it.y - 1) // so
				return true;
			if (elve.x == it.x + 1 && elve.y == it.y + 1) // nw
				return true;
			if (elve.x == it.x - 1 && elve.y == it.y) // o
				return true;
			if (elve.x == it.x && elve.y == it.y + 1) // s
				return true;
			if (elve.x == it.x && elve.y == it.y - 1) // n
				return true;
			if (elve.x == it.x - 1 && elve.y == it.y + 1) // sw
				return true;
		}
		return false;
	}

	public static String input = "...#######...####..#........#.#.##...##.##..#.##.####..####.##.##...###..##\r\n"
			+ "##.###.#...##..#....###..#.##.###.##..##..###..#....##.#..##.####..#.#.#.##\r\n"
			+ "..##.#.###.#......#...#....#...#.#.#...##......####..######.##....#####.##.\r\n"
			+ "##.#####.#.###.####.#....#.....####.#####..##.....#.##...###...#.####..#...\r\n"
			+ "...#.....#.#..#.######.###....#.....#.###..##..#.#.###..##..#.#......#..#..\r\n"
			+ ".###.#.##.##.##.....##.........#....#.#.#..#....###..####..#.#.###..###..#.\r\n"
			+ ".#####.......##.#..#...###.##...#.###...#..##.#.###.......##.#..#..##...##.\r\n"
			+ ".###.#.#.###.#.#..#..###..###..###.########.###..#.##.#.##...##.##.###.#...\r\n"
			+ ".....######.###.###.......####...##.#.##..#.#.##.#....##.###.#.###...###..#\r\n"
			+ "..#..##...#..#...##.#.#..###...#.##.##.##..##.###.#.#..#...#.#..#......####\r\n"
			+ "##..##.##..#.#.##...#.#.#...###.....#....###....#######.#####..#...#.##..##\r\n"
			+ "####....######.#..##...#....#.##....##.#..#.##..##..#.#.....##..####..#....\r\n"
			+ "....####..#.......##...#........#.##..#.#.#.##.##..##.##.....##..#...#.##.#\r\n"
			+ ".####..######.##.#.#.#.##...###..##...######..#.#.#.####.######.#...###....\r\n"
			+ "##..#.#...#.#.#.#.###.#.###.#.#.##.....#..##..##.##...###....#...#.###...#.\r\n"
			+ "#####.##...###..#.#.######..#.###...###..#..###.....#....####..#.####...###\r\n"
			+ "#.#.#....###.##...#.###.#.###.###..###.#.#.....#.##....#.##.##.#####..##..#\r\n"
			+ "...##.#...##....####.#.##.#.####.###...#.##....#..##.###..#......#######.##\r\n"
			+ "....#..#.#.#...##....#.####.##...#..#####...#.##..###..##...#..#.##.#.#.#.#\r\n"
			+ "..#..#####.#..#.#.#..#.###.##...#........#.#.....#.##.....#.##.#..#.#.#.#..\r\n"
			+ "..#.##.###....##.#..#.#####.....#.##.....#.#..###.###..#.#......#..#...#.##\r\n"
			+ "##.#.#...#...#.##..#......###.#.#.####.#...#########.#..#..##...##...##.###\r\n"
			+ "...#.###.#..#######.#.#.##.##..###.##.#.######.#.##.##.##.#########.#...#.#\r\n"
			+ "#..#...##.##.######.#..#.####...####.###.#...##.####..##..#.#...##.#.#.##..\r\n"
			+ ".##.###..#####.###.##..#.#.#.#....#.#....#...#....######.##.#...#...#.#...#\r\n"
			+ "#..#.....##....#.#..##.###..#..####..######...##.#..#######....#.#..##.##..\r\n"
			+ "##...#.##.#...#....#.##.##..#####...##.#.#.#.#...#...#.#....#.##..##..##..#\r\n"
			+ "..##....#..###...#.#.#.##....#...##...###.##.#.....#..#####.#####.....##..#\r\n"
			+ ".#.##..#.#.###..#...###.....##...###..#.#######.#..#.#.##.##..##.#.#..##.##\r\n"
			+ "#.#...#..###..#...####.#.#..##.#..#....#.#.#.###.#.##.##.#.......#.##....##\r\n"
			+ ".#.##.#.#..#.#.#.#.##..#.###..#....#..#...###.#.#.##..#.##..#..#.#..#...###\r\n"
			+ "..#..#.##......#....##.#######..#..##.....#.#.##..#..#..#.#.#..#.#..#.##...\r\n"
			+ "#.#.###.###..######.##....#####.####..#....##.##.##.....##..#..###...##..##\r\n"
			+ ".##..#.#.###..##.....###.#.##.#..#.....#.##..#...#...###...#...##...#####.#\r\n"
			+ ".....#....######..##.#..##..#...##.#.##.#..##...####.##..#.#.####.###......\r\n"
			+ "#..##....#.#.#.#....##..#....##...##.#...###.##..#....#.#...#.#..###...#..#\r\n"
			+ "...###.#.####..##...###.#.##.#..#.####.#.#.#####....####.#.#.#.##...#.##...\r\n"
			+ ".#..##.#...#..##.######.#######.#.#...##...##..#.#.########..#..##.#..###..\r\n"
			+ "..#####.####.#.#.##........###...#..###...##...#...#....####...##.#.#######\r\n"
			+ "#.#####......###.#..###.....##..##...######.#..##.#.#.#######..##.####...#.\r\n"
			+ "#.#.#.#..##..#.##..###....##.#.##.####..#.#####..###......#...#..#..###....\r\n"
			+ "..#...#.##..##.#..#####.######...###...#...##..#.#####..#.###....#..#.#.#..\r\n"
			+ "###..#.#####.##.#.######..##.#####...#...#####.#.#.#.#...#.#.#.#....##....#\r\n"
			+ "#.#...###...#.#...####..........#####..###..#.#...####...#.#.###.#..####.##\r\n"
			+ "..#..##.###.##...####.#....#..##.....####.##.#.#....#..#..##.#..##.#.#..###\r\n"
			+ "..#......##.#.####..###.####..##.####.##...#.#.####.#.#..#..######.##.##.##\r\n"
			+ "....###...#.##.####....#...#.#..#..##.#.####...##...#...#.#.##...##.##..#.#\r\n"
			+ "######....#.#..####.#.#...#####.#.#..##.######.#.###.#.#.#....#...#....##..\r\n"
			+ "....####...#..#.#.#.####.#..#..###..#..#.##.########...#..#.#.........#.#..\r\n"
			+ "##....#.#.##.####.#.#..##.#..##.#.#.#.#.#.#..#######.##..#.##....####...###\r\n"
			+ "##.#.#.##.#...###.#...#...##..#.#.#...#....#...#....#.#..###.##.##...##....\r\n"
			+ ".####....#.##...#.#.#.....#.#.#.#..#.....###.##.#..#...#...###.#..#.#..##.#\r\n"
			+ "##..#.#....##....#.##.##.#.###........#.#..#.#....#.#.###...####..##.####.#\r\n"
			+ ".##.#..###..#.#...###.###.###.###.#.#...##.#.#.###.#.####.###.##...#.#.#...\r\n"
			+ ".#.##.##..#.#.####..##.#####.#..#..####.###..###..####.....###.###.......#.\r\n"
			+ "##.#..#.#..###..#.....#.##.....#.#.#.##..######.#..#.#...#...##..###..##.#.\r\n"
			+ "##..##...#........##..##.######.#.####...#..#..####..#.##.#...#..#.##.#.##.\r\n"
			+ "#..#.##..###.#......####..##.##.#....#.###.##..#.#.#.##.##..#..#.##..##....\r\n"
			+ ".....#....#.#.##..#.##....####.####.....#.###.#.#..#.#.....#..##..##.###...\r\n"
			+ ".#......##....#.##.#...#.#####...##..##.....#.##.##.....#..#..##.#...#####.\r\n"
			+ "##.#...##...#....#.####.#.#....#.#..######..........####.....#.#.#......#..\r\n"
			+ "#.#.#....###..#..####..#.##...##.#####.#...#.#...###...#..##..##.####.#...#\r\n"
			+ "#...###.##.#..#.###..##...##.##..#...##.#....#.#.##.##....#.#....#...#####.\r\n"
			+ "#....##..####.....#.##.#####.#...##..##....#...###...#...#..#.#...#..#...##\r\n"
			+ "#..##.##.....##..#.###..........###...#.#...#..#..##..#...##.####.#....###.\r\n"
			+ ".#....#..#..##.###..########.#......#...#..#..##.##....###.###.....#...##.#\r\n"
			+ "##..###.#....#.#...##.#.###.#.#..#..#..###.#...#.##.#####.#.#..##..#.#..#.#\r\n"
			+ "#.#.#...#....#####.####..#.##.####..#.#.#...#....#..#.###...###.###...#...#\r\n"
			+ ".###..##.#..##..#..#...##.#.#...###..##.#.####.#....#.#...##....#....##..##\r\n"
			+ "..#.##..####.##..##...##..#.###.......#..####.##..#.#......#...##..###.....\r\n"
			+ "##....##.####.####..#.#.#..#####.....###.##..###..####.###.#####..#.....#.#\r\n"
			+ ".####.#..#####.....#..######...##.#....####......######...###..###..#.#.###\r\n"
			+ ".#..#.#.####.#.##........###.#.#.#.##.#..#...#......###.#.##.#..#.#...#...#\r\n"
			+ ".#..#.##....#...#...#.##..#...##.....#..######..##.###...#..#..####..#.#.#.\r\n"
			+ "##.#.#.#..#.##..#.#......#.######..#####...#.##.###.######.#...#.###.##...#";

}
